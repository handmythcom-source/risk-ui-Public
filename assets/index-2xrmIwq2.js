import{r as e}from"./rolldown-runtime-DGruFWvd.js";import{A as t,B as n,C as r,D as i,E as a,F as o,H as s,I as c,L as l,M as u,N as d,O as f,P as p,R as m,S as h,T as g,V as _,W as v,_ as y,a as b,b as x,c as S,d as C,f as w,g as T,h as E,i as D,j as O,k,l as ee,m as A,n as te,o as j,p as ne,r as M,s as re,t as N,u as ie,v as ae,w as P,x as F,y as oe,z as I}from"./antd-CTNwxd0-.js";import{a as L,c as R,i as se,l as ce,n as le,o as ue,r as z,s as B,t as de,u as fe}from"./react-kA6iE0S6.js";import{t as pe}from"./echarts-KOarZp8P.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var me=e(fe()),V=e(v()),H=e(de()),{Header:he,Sider:ge,Content:_e}=a,{Title:U}=A,W=[{key:`dashboard`,icon:(0,H.jsx)(S,{}),label:`风险全景`,path:`/`},{key:`factory`,icon:(0,H.jsx)(C,{}),label:`工厂管理`,children:[{key:`factories`,label:`工厂列表`,path:`/factories`,icon:(0,H.jsx)(D,{})}]},{key:`customs`,icon:(0,H.jsx)(ie,{}),label:`报关跟踪`,children:[{key:`customs-list`,label:`报关单列表`,path:`/customs`,icon:(0,H.jsx)(D,{})},{key:`customs-analytics`,label:`时效分析`,path:`/customs/analytics`,icon:(0,H.jsx)(j,{})}]},{key:`rebate`,icon:(0,H.jsx)(re,{}),label:`退税风险`,children:[{key:`rebates`,label:`退税记录`,path:`/rebates`,icon:(0,H.jsx)(D,{})},{key:`rebates-analytics`,label:`周期分析`,path:`/rebates/analytics`,icon:(0,H.jsx)(j,{})}]},{key:`risk`,icon:(0,H.jsx)(w,{}),label:`风险中心`,children:[{key:`risks`,label:`预警队列`,path:`/risks`,icon:(0,H.jsx)(w,{})},{key:`workorders`,label:`工单闭环`,path:`/risks/workorders`,icon:(0,H.jsx)(ee,{})}]},{key:`config`,icon:(0,H.jsx)(M,{}),label:`规则与配置`,children:[{key:`rules`,label:`规则管理`,path:`/rules`,icon:(0,H.jsx)(D,{})},{key:`settings`,label:`系统设置`,path:`/settings`,icon:(0,H.jsx)(M,{})},{key:`users`,label:`用户管理`,path:`/users`,icon:(0,H.jsx)(N,{})}]}];function ve(e){let t=W.find(t=>t.children?.some(t=>t.path===e));return t?[t.key]:[]}function ye(e){if(e===`/`)return[`dashboard`];for(let t of W){let n=t.children?.find(t=>t.path===e);if(n)return[n.key]}return[]}function be(){let e=R(),r=B(),[i,o]=(0,V.useState)(!1),[s,u]=(0,V.useState)(`风险预警管控系统`),[d,f]=(0,V.useState)(null);(0,V.useEffect)(()=>{let e=localStorage.getItem(`systemSettings`);if(e)try{let t=JSON.parse(e);u(t.systemName||`风险预警管控系统`),f(t.logoBase64||null)}catch{}},[]);let p=t=>{let n=W.flatMap(e=>e.children?e.children:[e]).find(e=>e.key===t.key);n?.path&&e(n.path)},m=ye(r.pathname),h=ve(r.pathname),g=W.map(e=>e.children?{key:e.key,icon:e.icon,label:e.label,children:e.children.map(e=>({key:e.key,label:e.label,icon:e.icon}))}:{key:e.key,icon:e.icon,label:e.label});return(0,H.jsxs)(a,{className:`app-shell`,style:{minHeight:`100vh`},children:[(0,H.jsxs)(ge,{collapsible:!0,collapsed:i,onCollapse:o,theme:`light`,width:280,style:{borderRight:`1px solid #eef2f5`},children:[(0,H.jsxs)(`div`,{style:{display:`flex`,alignItems:`center`,padding:`16px`,gap:12},children:[d?(0,H.jsx)(l,{shape:`square`,size:36,src:d}):(0,H.jsx)(l,{shape:`square`,size:36,style:{background:`#0EA5E9`},children:`LOGO`}),!i&&(0,H.jsx)(U,{level:5,style:{margin:0},children:s})]}),(0,H.jsx)(c,{mode:`inline`,items:g,selectedKeys:m,defaultOpenKeys:h,onClick:p})]}),(0,H.jsxs)(a,{children:[(0,H.jsx)(he,{children:(0,H.jsxs)(`div`,{style:{display:`flex`,alignItems:`center`,justifyContent:`space-between`},children:[(0,H.jsx)(t,{children:(0,H.jsx)(U,{level:4,style:{margin:0},children:s})}),(0,H.jsxs)(t,{children:[(0,H.jsx)(n,{type:`text`,onClick:()=>e(`/settings`),children:`系统设置`}),(0,H.jsx)(n,{type:`primary`,onClick:()=>{localStorage.removeItem(`token`),e(`/login`)},children:`退出登录`})]})]})}),(0,H.jsx)(_e,{className:`app-container`,children:(0,H.jsx)(se,{})})]})]})}function xe({children:e}){let t=localStorage.getItem(`token`),n=B();return t?e:(0,H.jsx)(z,{to:`/login`,state:{from:n},replace:!0})}var{Title:Se,Text:Ce}=A;function we(){let e=R(),r=B().state?.from?.pathname||`/`;return(0,H.jsx)(`div`,{style:{minHeight:`100vh`,display:`flex`,alignItems:`center`,justifyContent:`center`,background:`linear-gradient(180deg, #e6f7ff 0%, #f8fbff 100%)`},children:(0,H.jsxs)(p,{style:{width:420},children:[(0,H.jsxs)(t,{direction:`vertical`,style:{width:`100%`},align:`center`,children:[(0,H.jsx)(Se,{level:3,style:{marginBottom:4},children:`风险预警管控系统`}),(0,H.jsx)(Ce,{type:`secondary`,children:`请登录以进入系统`})]}),(0,H.jsxs)(k,{layout:`vertical`,onFinish:t=>{let{username:n,password:i}=t;n===`admin`&&i===`123456`||n===`user`&&i===`123456`?(localStorage.setItem(`token`,`demo-token`),localStorage.setItem(`currentUser`,JSON.stringify({username:n,role:n===`admin`?`管理员`:`业务员`})),e(r,{replace:!0})):alert(`用户名或密码错误：admin/123456 或 user/123456`)},style:{marginTop:16},children:[(0,H.jsx)(k.Item,{name:`username`,label:`用户名`,rules:[{required:!0,message:`请输入用户名`}],children:(0,H.jsx)(i,{prefix:(0,H.jsx)(N,{}),placeholder:`admin 或 user`,allowClear:!0})}),(0,H.jsx)(k.Item,{name:`password`,label:`密码`,rules:[{required:!0,message:`请输入密码`}],children:(0,H.jsx)(i.Password,{prefix:(0,H.jsx)(b,{}),placeholder:`123456`})}),(0,H.jsx)(n,{type:`primary`,htmlType:`submit`,block:!0,children:`登录`})]})]})})}function G({option:e,style:t}){let n=(0,V.useRef)(null),r=(0,V.useRef)(null);return(0,V.useEffect)(()=>{if(!n.current)return;r.current=pe(n.current),r.current.setOption(e);let t=()=>r.current?.resize();return window.addEventListener(`resize`,t),()=>{window.removeEventListener(`resize`,t),r.current?.dispose()}},[]),(0,V.useEffect)(()=>{r.current?.setOption(e,!0)},[e]),(0,H.jsx)(`div`,{ref:n,style:t||{height:300}})}var Te=[{id:`R001`,name:`发票三单不一致`,count:128,trendPercent:12},{id:`R002`,name:`异常报关频次`,count:115,trendPercent:-5},{id:`R003`,name:`退税周期过长`,count:98,trendPercent:3},{id:`R004`,name:`重复申报疑点`,count:86,trendPercent:-8},{id:`R005`,name:`金额异常波动`,count:79,trendPercent:6},{id:`R006`,name:`货物品类异常`,count:71,trendPercent:2},{id:`R007`,name:`物流轨迹异常`,count:66,trendPercent:-2},{id:`R008`,name:`高频人工干预`,count:62,trendPercent:4},{id:`R009`,name:`申报字段缺失`,count:58,trendPercent:1},{id:`R010`,name:`收发货异常区域`,count:55,trendPercent:-1}],Ee=[{id:`F001`,name:`A工厂`,count:42,severity:`红色`},{id:`F002`,name:`B工厂`,count:38,severity:`橙色`},{id:`F003`,name:`C工厂`,count:35,severity:`黄色`},{id:`F004`,name:`D工厂`,count:33,severity:`橙色`},{id:`F005`,name:`E工厂`,count:31,severity:`黄色`},{id:`F006`,name:`F工厂`,count:28,severity:`红色`},{id:`F007`,name:`G工厂`,count:26,severity:`黄色`},{id:`F008`,name:`H工厂`,count:24,severity:`橙色`},{id:`F009`,name:`I工厂`,count:23,severity:`黄色`},{id:`F010`,name:`J工厂`,count:21,severity:`黄色`}];function K(e){switch(e){case`7d`:return .6;case`30d`:return 1;case`90d`:return 1.4;default:return 1}}function q(e,t=5){let n=Math.round((Math.random()-.5)*t);return Math.max(e+n,0)}async function De(e=`30d`){let t=K(e);return Te.map(e=>({...e,count:Math.round(q(e.count*t,6)),trendPercent:q(e.trendPercent,4)}))}async function Oe(e=`30d`){let t=K(e);return Ee.map(e=>({...e,count:Math.round(q(e.count*t,6))}))}var ke={tooltip:{},xAxis:{type:`category`,data:[`低`,`中`,`高`,`极高`]},yAxis:{type:`value`},series:[{name:`工厂数量`,type:`bar`,data:[52,31,12,3],itemStyle:{color:`#0EA5E9`}}]},Ae={tooltip:{},xAxis:{type:`category`,data:[`1月`,`2月`,`3月`,`4月`,`5月`,`6月`]},yAxis:{type:`value`},series:[{name:`退税平均周期(天)`,type:`line`,data:[65,62,60,58,61,59],lineStyle:{color:`#0EA5E9`}}]},J=e=>e===`红色`?3:e===`橙色`?2:1,je=e=>e===`红色`?`red`:e===`橙色`?`orange`:`gold`;function Me(){let e=R(),[t,n]=(0,V.useState)(``),[r,i]=(0,V.useState)(!1),[a,o]=(0,V.useState)([]),[s,c]=(0,V.useState)([]),[l,u]=(0,V.useState)(`30d`),[f,h]=(0,V.useState)(!1),[_,v]=(0,V.useState)(!1);(0,V.useEffect)(()=>{let e=!0,t=async()=>{h(!0),v(!0);let[t,n]=await Promise.all([De(`30d`),Oe(l)]);e&&(o(t),c(n),h(!1),v(!1))};t();let n=setInterval(t,3e4);return()=>{e=!1,clearInterval(n)}},[l]);let b=()=>{try{return JSON.parse(localStorage.getItem(`dashboardFilters`)||`{}`)}catch{return{}}},S=e=>{let t=new URLSearchParams(e).toString();return t?`?${t}`:``},C=(t,a,o)=>s=>{if(s?.preventDefault?.(),r)return;i(!0);let c=b(),l={from:`dashboard`,ts:Date.now(),metric:t,...c,...o};n(t),setTimeout(()=>{i(!1),e(`${a}${S(l)}`)},250)},w=[{title:`规则名称`,dataIndex:`name`,render:(t,n)=>(0,H.jsx)(m,{title:`规则ID：${n.id}`,children:(0,H.jsx)(`a`,{onClick:()=>e(`/rules`),children:t})})},{title:`触发次数`,dataIndex:`count`,sorter:(e,t)=>e.count-t.count,defaultSortOrder:`descend`},{title:`趋势变化`,dataIndex:`trendPercent`,sorter:(e,t)=>e.trendPercent-t.trendPercent,render:e=>e>0?(0,H.jsxs)(T,{color:`green`,children:[`↑ `,e,`%`]}):e<0?(0,H.jsxs)(T,{color:`red`,children:[`↓ `,Math.abs(e),`%`]}):(0,H.jsx)(T,{children:`—`})}],E=[{title:`工厂名称`,dataIndex:`name`,render:(t,n)=>(0,H.jsx)(m,{title:`工厂ID：${n.id}`,children:(0,H.jsx)(`a`,{onClick:()=>e(`/factory/${n.id}`),children:t})})},{title:`触发规则数量`,dataIndex:`count`,sorter:(e,t)=>e.count-t.count,defaultSortOrder:`descend`},{title:`严重等级`,dataIndex:`severity`,sorter:(e,t)=>J(e.severity)-J(t.severity),render:e=>(0,H.jsx)(T,{color:je(e),children:e})}],D={tooltip:{},xAxis:{type:`category`,data:a.map(e=>e.name)},yAxis:{type:`value`},series:[{name:`触发次数`,type:`bar`,data:a.map(e=>e.count),itemStyle:{color:`#0EA5E9`}}]},O={tooltip:{},xAxis:{type:`category`,data:s.map(e=>e.name)},yAxis:{type:`value`},series:[{name:`触发规则数量`,type:`bar`,data:s.map(e=>e.count),itemStyle:{color:`#0EA5E9`}}]};return(0,H.jsxs)(`div`,{className:`content-page`,children:[(0,H.jsxs)(F,{gutter:16,children:[(0,H.jsx)(d,{xs:24,sm:12,lg:6,children:(0,H.jsx)(p,{hoverable:!0,className:`metric-card`,onClick:C(`total_factories`,`/factory/list`,{timeframe:`all`}),onTouchEnd:C(`total_factories`,`/factory/list`,{timeframe:`all`}),"data-testid":`metric-total-factories`,tabIndex:0,children:(0,H.jsx)(g,{spinning:t===`total_factories`,children:(0,H.jsx)(x,{title:`总工厂数`,value:98})})})}),(0,H.jsx)(d,{xs:24,sm:12,lg:6,children:(0,H.jsx)(p,{hoverable:!0,className:`metric-card`,onClick:C(`weekly_alerts`,`/risks`,{timeframe:`week`}),onTouchEnd:C(`weekly_alerts`,`/risks`,{timeframe:`week`}),"data-testid":`metric-weekly-alerts`,tabIndex:0,children:(0,H.jsx)(g,{spinning:t===`weekly_alerts`,children:(0,H.jsx)(x,{title:`本周新增预警`,value:12,suffix:(0,H.jsx)(T,{color:`red`,children:`红/3 橙/5 黄/4`})})})})}),(0,H.jsx)(d,{xs:24,sm:12,lg:6,children:(0,H.jsx)(p,{hoverable:!0,className:`metric-card`,onClick:C(`avg_rebate_cycle`,`/rebates/analytics`,{timeframe:`6m`}),onTouchEnd:C(`avg_rebate_cycle`,`/rebates/analytics`,{timeframe:`6m`}),"data-testid":`metric-avg-rebate-cycle`,tabIndex:0,children:(0,H.jsx)(g,{spinning:t===`avg_rebate_cycle`,children:(0,H.jsx)(x,{title:`平均退税周期(天)`,value:60})})})}),(0,H.jsx)(d,{xs:24,sm:12,lg:6,children:(0,H.jsx)(p,{hoverable:!0,className:`metric-card`,onClick:C(`closure_rate`,`/risks/workorders`,{status:`closed`}),onTouchEnd:C(`closure_rate`,`/risks/workorders`,{status:`closed`}),"data-testid":`metric-closure-rate`,tabIndex:0,children:(0,H.jsx)(g,{spinning:t===`closure_rate`,children:(0,H.jsx)(x,{title:`闭环率`,value:95,suffix:`%`})})})})]}),(0,H.jsxs)(F,{gutter:16,style:{marginTop:16},children:[(0,H.jsx)(d,{xs:24,lg:12,children:(0,H.jsx)(p,{title:`风险等级分布`,children:(0,H.jsx)(G,{option:ke,style:{height:340}})})}),(0,H.jsx)(d,{xs:24,lg:12,children:(0,H.jsx)(p,{title:`退税效率趋势`,children:(0,H.jsx)(G,{option:Ae,style:{height:340}})})})]}),(0,H.jsxs)(F,{gutter:16,style:{marginTop:16},children:[(0,H.jsx)(d,{xs:24,lg:12,children:(0,H.jsxs)(p,{title:`触发规则排名（Top 10）`,extra:(0,H.jsx)(`span`,{style:{color:`#8c8c8c`},children:`每30秒自动刷新`}),children:[(0,H.jsx)(G,{option:D,style:{height:240}}),(0,H.jsx)(y,{rowKey:`id`,size:`small`,pagination:!1,dataSource:a,columns:w,loading:f,style:{marginTop:12}})]})}),(0,H.jsx)(d,{xs:24,lg:12,children:(0,H.jsxs)(p,{title:`当前触发规则的工厂排名（Top 10）`,extra:(0,H.jsx)(I,{size:`small`,value:l,onChange:u,options:[{value:`7d`,label:`近7天`},{value:`30d`,label:`近30天`},{value:`90d`,label:`近90天`}]}),children:[(0,H.jsx)(G,{option:O,style:{height:240}}),(0,H.jsx)(y,{rowKey:`id`,size:`small`,pagination:!1,dataSource:s,columns:E,loading:_,style:{marginTop:12}})]})})]})]})}var Y=e=>new Promise(t=>setTimeout(t,e)),X=`/api`,Z=async e=>{try{let t=await fetch(e);if(!t.ok)throw Error(`HTTP ${t.status}`);return await t.json()}catch{return null}};async function Ne(e){return await Z(`${X}/factories/${e}`)||(await Y(500),{id:e,basic:{name:`${e}工厂`,address:`上海市浦东新区示例路88号`,contact:`021-888888`,phone:`138****0000`,email:`factory@example.com`},capacity:{equipmentCount:56,employees:320,capacity:{monthly:`12000件`,daily:`400件`}},certifications:[`ISO9001`,`ISO14001`,`CE`,`RoHS`],customers:[{name:`阿里巴巴`,case:`年度代工合作`},{name:`华为`,case:`专项供应项目`}],gallery:[`/public/vite.svg`,`/public/vite.svg`,`/public/vite.svg`]})}async function Pe(e){return await Z(`${X}/factories/${e}/score`)||(await Y(500),{id:e,score:86,dimensions:[{key:`质量`,score:88,notes:`来料检验严格，不良率低`},{key:`交期`,score:82,notes:`交付准时率高，旺季略有波动`},{key:`服务`,score:90,notes:`沟通响应快，售后完善`},{key:`成本`,score:84,notes:`成本控制良好，有优化空间`}],trend:{months:[`1月`,`2月`,`3月`,`4月`,`5月`,`6月`],values:[80,82,84,85,86,87]},suggestions:[`提升旺季排产能力，减少交期波动`,`持续优化供应链，降低采购成本`]})}var Fe=[{id:1,name:`A工厂`,taxpayerId:`9137XXXXA`,rating:`A`,lawsuit:`无`,region:`上海`,riskScore:88,tags:[`高效率`]},{id:2,name:`B工厂`,taxpayerId:`9137XXXXB`,rating:`B`,lawsuit:`原告`,region:`杭州`,riskScore:72,tags:[`地址变更`]},{id:3,name:`C工厂`,taxpayerId:`9137XXXXC`,rating:`C`,lawsuit:`被告`,region:`苏州`,riskScore:55,tags:[`高税负波动`]}];function Q(){let e=R(),[n,a]=(0,V.useState)(``),[o,s]=(0,V.useState)(),[c,l]=(0,V.useState)(!1),[u,d]=(0,V.useState)(!1),[f,m]=(0,V.useState)(null);(0,V.useEffect)(()=>{try{let e=JSON.parse(localStorage.getItem(`factoryFilters`)||`{}`);a(e.keyword||``),s(e.rating)}catch{}},[]);let _=(0,V.useMemo)(()=>Fe.filter(e=>(!o||e.rating===o)&&(!n||e.name.includes(n)||e.taxpayerId.includes(n))),[n,o]),v=async e=>{l(!0),d(!0);try{let t=await Pe(e);m(t)}catch(e){r.error(e.message||`评分报告加载失败`)}finally{d(!1)}},b=()=>{l(!1),m(null)},x=t=>{localStorage.setItem(`factoryFilters`,JSON.stringify({keyword:n,rating:o})),e(`/factory/${t}`)},S=[{title:`企业名称`,dataIndex:`name`},{title:`纳税人识别号`,dataIndex:`taxpayerId`},{title:`纳税评级`,dataIndex:`rating`},{title:`法律诉讼`,dataIndex:`lawsuit`},{title:`地域`,dataIndex:`region`},{title:`风险评分`,dataIndex:`riskScore`},{title:`风险标签`,dataIndex:`tags`,render:e=>e.map(e=>(0,H.jsx)(T,{children:e},e))},{title:`操作`,render:(e,n)=>(0,H.jsxs)(t,{children:[(0,H.jsx)(`div`,{className:`op-action`,onClick:()=>x(n.id),children:`详情`}),(0,H.jsx)(`a`,{className:`op-action`,onClick:()=>v(n.id),children:`评分报告`})]})}],C=f?{tooltip:{},xAxis:{type:`category`,data:f.trend.months},yAxis:{type:`value`},series:[{type:`line`,data:f.trend.values,lineStyle:{color:`#0EA5E9`}}]}:null;return(0,H.jsxs)(`div`,{className:`content-page`,children:[(0,H.jsx)(p,{title:`工厂列表`,extra:(0,H.jsxs)(t,{children:[(0,H.jsx)(i,{placeholder:`名称或识别号`,value:n,onChange:e=>a(e.target.value),allowClear:!0}),(0,H.jsx)(I,{placeholder:`纳税评级`,value:o,onChange:s,allowClear:!0,style:{width:120},options:[{value:`A`,label:`A`},{value:`B`,label:`B`},{value:`C`,label:`C`}]})]}),children:(0,H.jsx)(y,{rowKey:`id`,dataSource:_,columns:S,pagination:{pageSize:8}})}),(0,H.jsxs)(h,{title:f?`评分报告 - 工厂 ${f.id}`:`评分报告`,open:c,onCancel:b,footer:null,width:720,children:[u&&(0,H.jsx)(`div`,{style:{textAlign:`center`},children:(0,H.jsx)(g,{})}),!u&&f&&(0,H.jsxs)(`div`,{style:{display:`grid`,gap:12},children:[(0,H.jsx)(p,{size:`small`,title:`综合评分`,children:(0,H.jsxs)(t,{children:[(0,H.jsx)(T,{color:`blue`,children:`百分制`}),(0,H.jsx)(`span`,{style:{fontSize:24,fontWeight:600},children:f.score})]})}),(0,H.jsx)(p,{size:`small`,title:`评分维度`,children:(0,H.jsx)(y,{size:`small`,rowKey:e=>e.key,dataSource:f.dimensions,columns:[{title:`维度`,dataIndex:`key`},{title:`分数`,dataIndex:`score`},{title:`评分依据`,dataIndex:`notes`}],pagination:!1})}),(0,H.jsx)(p,{size:`small`,title:`历史评分趋势`,children:(0,H.jsx)(G,{option:C,style:{height:220}})}),(0,H.jsx)(p,{size:`small`,title:`改进建议`,children:f.suggestions.map((e,t)=>(0,H.jsxs)(`div`,{children:[`• `,e]},t))})]})]})]})}function $(){let{id:e}=ce(),t=R(),[n,r]=(0,V.useState)(!0),[i,a]=(0,V.useState)(``),[o,s]=(0,V.useState)(null);return(0,V.useEffect)(()=>{let t=!0;return r(!0),a(``),Ne(e).then(e=>{t&&s(e)}).catch(e=>a(e.message||`加载失败`)).finally(()=>t&&r(!1)),()=>{t=!1}},[e]),(0,H.jsx)(`div`,{className:`content-page`,children:(0,H.jsx)(F,{gutter:16,children:(0,H.jsx)(d,{span:24,children:(0,H.jsxs)(p,{title:`工厂详情 - ${e}`,extra:(0,H.jsx)(`a`,{onClick:()=>t(-1),children:`返回`}),children:[i&&(0,H.jsx)(_,{type:`error`,message:i,showIcon:!0,style:{marginBottom:8}}),(0,H.jsx)(g,{spinning:n,children:o&&(0,H.jsxs)(F,{gutter:[16,16],children:[(0,H.jsx)(d,{xs:24,lg:12,children:(0,H.jsx)(p,{title:`工厂基本信息`,children:(0,H.jsxs)(O,{column:1,children:[(0,H.jsx)(O.Item,{label:`名称`,children:o.basic.name}),(0,H.jsx)(O.Item,{label:`地址`,children:o.basic.address}),(0,H.jsx)(O.Item,{label:`联系方式`,children:o.basic.contact}),(0,H.jsx)(O.Item,{label:`电话`,children:o.basic.phone}),(0,H.jsx)(O.Item,{label:`邮箱`,children:o.basic.email})]})})}),(0,H.jsx)(d,{xs:24,lg:12,children:(0,H.jsx)(p,{title:`生产能力信息`,children:(0,H.jsxs)(O,{column:1,children:[(0,H.jsx)(O.Item,{label:`设备数量`,children:o.capacity.equipmentCount}),(0,H.jsx)(O.Item,{label:`员工规模`,children:o.capacity.employees}),(0,H.jsx)(O.Item,{label:`月产能`,children:o.capacity.capacity.monthly}),(0,H.jsx)(O.Item,{label:`日产能`,children:o.capacity.capacity.daily})]})})}),(0,H.jsx)(d,{xs:24,lg:12,children:(0,H.jsx)(p,{title:`资质认证信息`,children:(0,H.jsx)(P,{dataSource:o.certifications,renderItem:e=>(0,H.jsx)(P.Item,{children:(0,H.jsx)(T,{color:`blue`,children:e})})})})}),(0,H.jsx)(d,{xs:24,lg:12,children:(0,H.jsx)(p,{title:`合作客户案例`,children:(0,H.jsx)(P,{dataSource:o.customers,renderItem:e=>(0,H.jsx)(P.Item,{children:(0,H.jsx)(P.Item.Meta,{title:e.name,description:e.case})})})})}),(0,H.jsx)(d,{span:24,children:(0,H.jsx)(p,{title:`工厂实景照片展示`,children:(0,H.jsx)(F,{gutter:[8,8],children:o.gallery.map((e,t)=>(0,H.jsx)(d,{xs:12,sm:8,md:6,lg:4,children:(0,H.jsx)(f,{src:e,alt:`factory-${t}`,width:`100%`})},t))})})})]})})]})})})})}var Ie=e=>{let t=[`待提交`,`已申报`,`已放行`,`退税中`,`已退税`],n=t.indexOf(e);return(0,H.jsx)(oe,{size:`small`,current:n,items:t.map(e=>({title:e}))})},Le=[{id:`D20240101`,type:`进口`,factory:`A工厂`,goods:`耐火材料`,amount:12e4,status:`已申报`,invoice:`INV202312`,logistics:`顺丰`,consistency:`一致`,createdAt:`2024-01-01`,declaredAt:`2024-01-02`},{id:`D20240102`,type:`出口`,factory:`B工厂`,goods:`机电产品`,amount:98e3,status:`已放行`,invoice:`INV202311`,logistics:`中通`,consistency:`不一致`,createdAt:`2024-01-03`,declaredAt:`2024-01-05`},{id:`D20240103`,type:`转关`,factory:`C工厂`,goods:`塑料制品`,amount:56e3,status:`待申报`,invoice:`INV202310`,logistics:`德邦`,consistency:`一致`,createdAt:`2024-01-04`,declaredAt:``},{id:`D20240104`,type:`进口`,factory:`D工厂`,goods:`化工原料`,amount:188e3,status:`异常`,invoice:`INV202309`,logistics:`申通`,consistency:`不一致`,createdAt:`2024-01-06`,declaredAt:`2024-01-07`}],Re=[{value:`进口`,label:`进口`},{value:`出口`,label:`出口`},{value:`转关`,label:`转关`}],ze=[{value:`待申报`,label:`待申报`},{value:`已申报`,label:`已申报`},{value:`已放行`,label:`已放行`},{value:`异常`,label:`异常`}];function Be(){let[e,r]=(0,V.useState)([]),[a,s]=(0,V.useState)([]),[c,l]=(0,V.useState)(`createdAt`),[d,f]=(0,V.useState)([]),[h,g]=(0,V.useState)(``),[_,v]=(0,V.useState)(!1),[b,x]=(0,V.useState)(``),[S,C]=(0,V.useState)({types:[],statuses:[],dateField:`createdAt`,range:[],keyword:``});(0,V.useEffect)(()=>{try{let e=JSON.parse(localStorage.getItem(`customsFilters`)||`{}`);r(e.types||[]),s(e.statuses||[]),l(e.dateField||`createdAt`),f(e.range||[]),g(e.keyword||``),x(e.keyword||``),v(e.liveUpdate||!1),e.liveUpdate&&C({types:e.types||[],statuses:e.statuses||[],dateField:e.dateField||`createdAt`,range:e.range||[],keyword:e.keyword||``})}catch{}},[]),(0,V.useEffect)(()=>{_&&(C({types:e,statuses:a,dateField:c,range:d,keyword:h}),localStorage.setItem(`customsFilters`,JSON.stringify({types:e,statuses:a,dateField:c,range:d,keyword:h,liveUpdate:_})))},[e,a,c,d,h,_]),(0,V.useEffect)(()=>{if(!_)return;let e=setTimeout(()=>g(b),200);return()=>clearTimeout(e)},[b,_]);let w=(0,V.useMemo)(()=>{let t=_?{types:e,statuses:a,dateField:c,range:d,keyword:h}:S,[n,r]=t.range||[],i=n?n.format(`YYYY-MM-DD`):null,o=r?r.format(`YYYY-MM-DD`):null;return Le.filter(e=>{let n=!t.types?.length||t.types.includes(e.type),r=!t.statuses?.length||t.statuses.includes(e.status),a=!t.keyword||e.id.includes(t.keyword),s=!0;if(i||o){let n=e[t.dateField];if(!n)return!1;s=(!i||n>=i)&&(!o||n<=o)}return n&&r&&a&&s})},[e,a,c,d,h,S,_]);return(0,H.jsx)(`div`,{className:`content-page`,children:(0,H.jsxs)(p,{title:`报关单列表`,children:[(0,H.jsx)(`div`,{className:`toolbar`,style:{marginBottom:12},children:(0,H.jsxs)(k,{className:`filters-inline`,layout:`inline`,children:[(0,H.jsx)(k.Item,{className:`filter-item`,label:`类型`,style:{display:`flex`,alignItems:`center`,height:40},children:(0,H.jsx)(I,{mode:`multiple`,allowClear:!0,placeholder:`选择类型`,value:e,onChange:r,options:Re,maxTagCount:`responsive`,style:{width:160}})}),(0,H.jsx)(k.Item,{className:`filter-item`,label:`状态`,style:{display:`flex`,alignItems:`center`,height:40},children:(0,H.jsx)(I,{mode:`multiple`,allowClear:!0,placeholder:`选择状态`,value:a,onChange:s,options:ze,maxTagCount:`responsive`,style:{width:160}})}),(0,H.jsx)(k.Item,{className:`filter-item`,label:`单号`,style:{display:`flex`,alignItems:`center`,height:40},children:(0,H.jsx)(i,{placeholder:`模糊查询，如 D202401`,value:b,onChange:e=>x(e.target.value),allowClear:!0,style:{width:220}})}),(0,H.jsx)(`div`,{className:`filters-break`,style:{flexBasis:`100%`,height:0}}),(0,H.jsxs)(k.Item,{className:`filter-item`,label:`日期`,style:{display:`flex`,alignItems:`center`,height:40,flex:1},children:[(0,H.jsxs)(o.Group,{value:c,onChange:e=>l(e.target.value),style:{marginRight:8},children:[(0,H.jsx)(o.Button,{value:`createdAt`,children:`创建日期`}),(0,H.jsx)(o.Button,{value:`declaredAt`,children:`申报日期`})]}),(0,H.jsx)(u.RangePicker,{value:d,onChange:f,style:{width:280},getPopupContainer:e=>e.parentNode})]}),(0,H.jsx)(`div`,{style:{marginLeft:`auto`,display:`flex`,alignItems:`center`,height:40},children:(0,H.jsxs)(t,{children:[(0,H.jsx)(n,{type:`primary`,onClick:()=>{g(b),C({types:e,statuses:a,dateField:c,range:d,keyword:b}),localStorage.setItem(`customsFilters`,JSON.stringify({types:e,statuses:a,dateField:c,range:d,keyword:b,liveUpdate:_}))},children:`查询`}),(0,H.jsx)(n,{onClick:()=>{r([]),s([]),l(`createdAt`),f([]),g(``),x(``),C({types:[],statuses:[],dateField:`createdAt`,range:[],keyword:``}),localStorage.removeItem(`customsFilters`)},children:`重置`}),(0,H.jsxs)(t,{children:[(0,H.jsx)(ae,{checked:_,onChange:v}),(0,H.jsx)(`span`,{children:`实时刷新`})]})]})})]})}),(0,H.jsx)(y,{rowKey:`id`,columns:[{title:`报关单号`,dataIndex:`id`,width:100,ellipsis:!0},{title:`类型`,dataIndex:`type`,render:e=>(0,H.jsx)(T,{children:e}),width:80},{title:`工厂`,dataIndex:`factory`,width:110,ellipsis:!0},{title:`货物名称`,dataIndex:`goods`,width:120,ellipsis:!0},{title:`金额`,dataIndex:`amount`,width:90},{title:`状态`,dataIndex:`status`,width:450,render:e=>(0,H.jsxs)(`div`,{className:`status-cell`,children:[(0,H.jsx)(m,{title:`当前状态：${e}（流程：待提交 > 已申报 > 已放行 > 退税中 > 已退税）`,children:Ie(e)}),(0,H.jsx)(`span`,{className:`status-text-print`,children:e})]})},{title:`发票号`,dataIndex:`invoice`,width:100,ellipsis:!0},{title:`物流公司`,dataIndex:`logistics`,width:90,ellipsis:!0},{title:`三单一致性`,dataIndex:`consistency`,render:e=>(0,H.jsx)(T,{color:e===`一致`?`green`:`red`,children:e}),width:90}],dataSource:w,pagination:{pageSize:10},tableLayout:`fixed`,scroll:{x:1230,y:480}})]})})}var Ve={title:{text:`物流与报关时效偏差`},tooltip:{},legend:{data:[`本厂`,`行业均值`]},xAxis:{type:`category`,data:[`报关`,`运输`,`放行`]},yAxis:{type:`value`,name:`小时`},series:[{name:`本厂`,type:`bar`,data:[8,24,6],itemStyle:{color:`#0EA5E9`}},{name:`行业均值`,type:`bar`,data:[6,20,5],itemStyle:{color:`#65c3f7`}}]};function He(){return(0,H.jsx)(`div`,{className:`content-page`,children:(0,H.jsx)(p,{children:(0,H.jsx)(G,{option:Ve,style:{height:360}})})})}var Ue=[{id:`R20240101`,declareId:`D20240101`,rate:13,amount:15600,applyDate:`2024-02-02`,received:`2024-03-05`,forex:`匹配`,cycleDays:60},{id:`R20240102`,declareId:`D20240102`,rate:9,amount:8820,applyDate:`2024-02-10`,received:`2024-03-10`,forex:`不匹配`,cycleDays:72}];function We(){return(0,H.jsx)(`div`,{className:`content-page`,children:(0,H.jsx)(p,{title:`退税记录`,children:(0,H.jsx)(y,{rowKey:`id`,columns:[{title:`退税单号`,dataIndex:`id`},{title:`报关单号`,dataIndex:`declareId`},{title:`退税率(%)`,dataIndex:`rate`},{title:`退税金额`,dataIndex:`amount`},{title:`申请日期`,dataIndex:`applyDate`},{title:`到账日期`,dataIndex:`received`},{title:`外汇核销`,dataIndex:`forex`,render:e=>(0,H.jsx)(T,{color:e===`匹配`?`green`:`red`,children:e})},{title:`退税周期(天)`,dataIndex:`cycleDays`}],dataSource:Ue})})})}var Ge={title:{text:`退税额波动`},tooltip:{},xAxis:{type:`category`,data:[`1月`,`2月`,`3月`,`4月`,`5月`,`6月`]},yAxis:{type:`value`},series:[{name:`退税额(万元)`,type:`line`,data:[120,160,110,180,140,150],lineStyle:{color:`#0EA5E9`}}]};function Ke(){return(0,H.jsx)(`div`,{className:`content-page`,children:(0,H.jsx)(p,{children:(0,H.jsx)(G,{option:Ge,style:{height:360}})})})}var qe=[{id:`E1001`,factory:`A工厂`,type:`重大经营风险`,level:`红色`,status:`待分派`,time:`2024-06-01 10:22`},{id:`E1002`,factory:`B工厂`,type:`高频操作风险`,level:`橙色`,status:`整改中`,time:`2024-06-02 12:01`},{id:`E1003`,factory:`C工厂`,type:`潜在合规风险`,level:`黄色`,status:`待分派`,time:`2024-06-02 13:45`}],Je=e=>e===`红色`?`red`:e===`橙色`?`orange`:`gold`;function Ye(){let[e,i]=(0,V.useState)(qe),a=e=>{i(t=>t.map(t=>t.id===e?{...t,status:`整改中`}:t)),r.success(`已分派整改`)},o=e=>{i(t=>t.map(t=>t.id===e?{...t,status:`已关闭`}:t)),r.success(`工单已关闭`)};return(0,H.jsx)(`div`,{className:`content-page`,children:(0,H.jsx)(p,{title:`预警队列`,children:(0,H.jsx)(y,{rowKey:`id`,dataSource:e,columns:[{title:`事件ID`,dataIndex:`id`},{title:`工厂`,dataIndex:`factory`},{title:`风险类型`,dataIndex:`type`},{title:`预警等级`,dataIndex:`level`,render:e=>(0,H.jsx)(T,{color:Je(e),children:e})},{title:`触发时间`,dataIndex:`time`},{title:`处理状态`,dataIndex:`status`},{title:`操作`,render:(e,r)=>(0,H.jsxs)(t,{children:[(0,H.jsx)(n,{size:`small`,onClick:()=>a(r.id),children:`分派`}),(0,H.jsx)(n,{size:`small`,type:`primary`,onClick:()=>o(r.id),children:`关闭`})]})}]})})})}var Xe=[{id:`W001`,eventId:`E1001`,factory:`A工厂`,sla:`24h`,status:`整改中`,owner:`风控-张三`},{id:`W002`,eventId:`E1002`,factory:`B工厂`,sla:`48h`,status:`已关闭`,owner:`业务-李四`}];function Ze(){return(0,H.jsx)(`div`,{className:`content-page`,children:(0,H.jsx)(p,{title:`工单闭环`,children:(0,H.jsx)(y,{rowKey:`id`,dataSource:Xe,columns:[{title:`工单ID`,dataIndex:`id`},{title:`事件ID`,dataIndex:`eventId`},{title:`工厂`,dataIndex:`factory`},{title:`SLA`,dataIndex:`sla`},{title:`状态`,dataIndex:`status`,render:e=>(0,H.jsx)(T,{color:e===`已关闭`?`green`:`orange`,children:e})},{title:`责任人`,dataIndex:`owner`}]})})})}var Qe=[{id:`R-001`,name:`国际价格偏离度>20%`,type:`静态`,priority:1,enabled:!0},{id:`R-002`,name:`连续3次单证错误`,type:`动态`,priority:2,enabled:!0},{id:`R-003`,name:`退税率>13%且单价>同类均价`,type:`退税专项`,priority:2,enabled:!1}];function $e(){let[e,t]=(0,V.useState)(Qe),n=(e,n)=>t(t=>t.map(t=>t.id===e?{...t,enabled:n}:t));return(0,H.jsx)(`div`,{className:`content-page`,children:(0,H.jsx)(p,{title:`规则管理`,children:(0,H.jsx)(y,{rowKey:`id`,columns:[{title:`规则ID`,dataIndex:`id`},{title:`名称`,dataIndex:`name`},{title:`类型`,dataIndex:`type`,render:e=>(0,H.jsx)(T,{children:e})},{title:`优先级`,dataIndex:`priority`},{title:`启用`,dataIndex:`enabled`,render:(e,t)=>(0,H.jsx)(ae,{checked:e,onChange:e=>n(t.id,e)})}],dataSource:e})})})}function et(e){return new Promise((t,n)=>{let r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=n})}function tt(){let[e]=k.useForm(),[a,o]=(0,V.useState)(null);return(0,V.useEffect)(()=>{let t=localStorage.getItem(`systemSettings`);if(t)try{let n=JSON.parse(t);e.setFieldsValue({systemName:n.systemName}),o(n.logoBase64||null)}catch{}},[]),(0,H.jsx)(`div`,{className:`content-page`,children:(0,H.jsx)(p,{title:`系统设置`,children:(0,H.jsxs)(t,{align:`start`,style:{width:`100%`},children:[(0,H.jsx)(l,{shape:`square`,size:80,src:a,style:{background:`#0EA5E9`},children:`LOGO`}),(0,H.jsxs)(k,{layout:`vertical`,form:e,style:{flex:1},children:[(0,H.jsxs)(k.Item,{name:`systemName`,label:`系统名称`,rules:[{required:!0,message:`请输入系统名称`}],children:[` `,(0,H.jsx)(i,{placeholder:`风险预警管控系统`}),` `]}),(0,H.jsxs)(k.Item,{label:`系统LOGO`,children:[` `,(0,H.jsxs)(ne,{accept:`image/*`,maxCount:1,showUploadList:!1,beforeUpload:async e=>{let t=await et(e);return o(t),r.success(`LOGO已选择，保存后生效`),!1},children:[` `,(0,H.jsx)(n,{icon:(0,H.jsx)(te,{}),children:`上传LOGO`}),` `]}),` `]}),(0,H.jsx)(n,{type:`primary`,onClick:async()=>{let t={systemName:e.getFieldsValue().systemName||`风险预警管控系统`,logoBase64:a};localStorage.setItem(`systemSettings`,JSON.stringify(t)),r.success(`设置已保存（本地存储）`)},children:`保存`})]})]})})})}var nt=[{id:1,username:`admin`,role:`管理员`,status:`启用`},{id:2,username:`user`,role:`业务员`,status:`启用`}];function rt(){let[e,t]=(0,V.useState)(nt),[r,a]=(0,V.useState)(!1);return(0,H.jsx)(`div`,{className:`content-page`,children:(0,H.jsxs)(p,{title:`用户管理`,extra:(0,H.jsx)(n,{type:`primary`,onClick:()=>a(!0),children:`新增用户`}),children:[(0,H.jsx)(y,{rowKey:`id`,columns:[{title:`用户名`,dataIndex:`username`},{title:`角色`,dataIndex:`role`,render:e=>(0,H.jsx)(T,{color:e===`管理员`?`blue`:`green`,children:e})},{title:`状态`,dataIndex:`status`,render:e=>(0,H.jsx)(T,{color:e===`启用`?`green`:`red`,children:e})}],dataSource:e}),(0,H.jsx)(h,{title:`新增用户`,open:r,onCancel:()=>a(!1),footer:null,children:(0,H.jsxs)(k,{layout:`vertical`,onFinish:e=>{t(t=>[...t,{id:Date.now(),...e}]),a(!1)},children:[(0,H.jsxs)(k.Item,{name:`username`,label:`用户名`,rules:[{required:!0}],children:[` `,(0,H.jsx)(i,{}),` `]}),(0,H.jsxs)(k.Item,{name:`role`,label:`角色`,rules:[{required:!0}],children:[` `,(0,H.jsx)(I,{options:[{value:`管理员`,label:`管理员`},{value:`风控`,label:`风控`},{value:`业务员`,label:`业务员`}]}),` `]}),(0,H.jsxs)(k.Item,{name:`status`,label:`状态`,initialValue:`启用`,rules:[{required:!0}],children:[` `,(0,H.jsx)(I,{options:[{value:`启用`,label:`启用`},{value:`停用`,label:`停用`}]}),` `]}),(0,H.jsx)(n,{type:`primary`,htmlType:`submit`,block:!0,children:`保存`})]})})]})})}function it(){return(0,H.jsxs)(ue,{children:[(0,H.jsx)(L,{path:`/login`,element:(0,H.jsx)(we,{})}),(0,H.jsxs)(L,{path:`/`,element:(0,H.jsx)(xe,{children:(0,H.jsx)(be,{})}),children:[(0,H.jsx)(L,{index:!0,element:(0,H.jsx)(Me,{})}),(0,H.jsx)(L,{path:`factories`,element:(0,H.jsx)(Q,{})}),(0,H.jsx)(L,{path:`factory/list`,element:(0,H.jsx)(Q,{})}),(0,H.jsx)(L,{path:`factory/:id`,element:(0,H.jsx)($,{})}),(0,H.jsx)(L,{path:`factories/:id`,element:(0,H.jsx)($,{})}),(0,H.jsx)(L,{path:`customs`,element:(0,H.jsx)(Be,{})}),(0,H.jsx)(L,{path:`customs/analytics`,element:(0,H.jsx)(He,{})}),(0,H.jsx)(L,{path:`rebates`,element:(0,H.jsx)(We,{})}),(0,H.jsx)(L,{path:`rebates/analytics`,element:(0,H.jsx)(Ke,{})}),(0,H.jsx)(L,{path:`risks`,element:(0,H.jsx)(Ye,{})}),(0,H.jsx)(L,{path:`risks/workorders`,element:(0,H.jsx)(Ze,{})}),(0,H.jsx)(L,{path:`rules`,element:(0,H.jsx)($e,{})}),(0,H.jsx)(L,{path:`settings`,element:(0,H.jsx)(tt,{})}),(0,H.jsx)(L,{path:`users`,element:(0,H.jsx)(rt,{})})]}),(0,H.jsx)(L,{path:`*`,element:(0,H.jsx)(z,{to:`/`})})]})}var at=`#0EA5E9`;me.createRoot(document.getElementById(`root`)).render((0,H.jsx)(V.StrictMode,{children:(0,H.jsx)(s,{theme:{token:{colorPrimary:at,colorInfo:at,borderRadius:6,colorTextHeading:`#0b1e2f`},algorithm:E.defaultAlgorithm},children:(0,H.jsx)(le,{children:(0,H.jsx)(it,{})})})}));